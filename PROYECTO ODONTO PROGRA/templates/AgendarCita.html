{% extends "base.html" %}

{% block title %}Agendar una Cita - NeoSmile{% endblock %}

{# No necesitamos un CSS específico si los estilos de formulario son globales, 
   pero dejamos el bloque por si acaso en el futuro. #}
{% block head_css %}{% endblock %}


{% block content %}

    <section class="section-header centered-text">
        <h1>Agendar una Cita</h1>
        <p>Complete el formulario para solicitar su cita con nuestros especialistas.</p>
    </section>

    <div class="form-wrapper"> <form method="POST" action="{{ url_for('ruta_agendar_cita') }}" novalidate>
            
            <h3>Información Personal</h3>
            <div class="form-group" style="text-align: right;">
                <button type="button" id="autofillBtn" class="btn secondary">Llenar con mis datos</button>
            </div>

            <div class="form-group">
                <label for="nombre">Nombre completo</label>
                <input type="text" id="nombre" name="nombre" placeholder="Ingrese su nombre y apellidos" required>
            </div>

            <div class="form-group">
                <label for="correo">Correo electrónico</label>
                <input type="email" id="correo" name="correo" placeholder="ejemplo@correo.com" required>
            </div>

            <div class="form-group">
                <label for="telefono">Teléfono</label>
                <input type="tel" id="telefono" name="telefono" placeholder="Ingrese su número de teléfono" required>
            </div>
            
            <div class="form-group">
                <label for="fecha_nacimiento">Fecha de Nacimiento</p>
                <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required>
            </div>

            <hr class="form-separator"> <h3>Detalles de la Cita</h3>

            <div class="form-group">
                <label for="especialidad">Especialidad requerida</label>
                <select id="especialidad" name="especialidad" required>
                    <option value="" selected disabled>Seleccione una especialidad</option>
                    {% for esp in especialidades_db %}
                        <option value="{{ esp.id_especialidad }}">{{ esp.nombre_especialidad }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="especialista">Especialista (opcional)</label>
                <select id="especialista" name="especialista">
                    <option value="" selected disabled>Seleccione un especialista si lo desea</option>
                    </select>
            </div>

            <div class="form-group">
                <label for="fecha">Fecha preferida para la cita</label>
                <input type="date" id="fecha" name="fecha" required>
            </div>

            <div class="form-group">
                <label for="hora">Horario disponible</label>
               <div id="time-slots-container" class="time-slots-grid">
                    <p class="time-slots-placeholder">Por favor, selecciona un especialista y una fecha para ver los horarios.</p>
                </div>
                    <input type="hidden" id="hora" name="hora" required> 
            </div>
            </div>

            <div class="form-group">
                <label for="motivo">Motivo de la consulta</label>
                <textarea id="motivo" name="motivo" rows="4" placeholder="Describa brevemente el motivo de su consulta"></textarea>
            </div>
            
            <hr class="form-separator">

            <div class="form-group form-check-group">
                 <input type="checkbox" id="primera_visita" name="primera_visita" value="si">
                 <label for="primera_visita">¿Es su primera visita a nuestra clínica?</label>
            </div>
            
            <div class="form-group form-check-group">
                 <input type="checkbox" id="condicion_medica" name="condicion_medica" value="si">
                 <label for="condicion_medica">¿Tiene alguna condición médica relevante?</label>
            </div>

            <div class="form-group submit-group">
                <button type="submit" class="btn primary">Enviar Solicitud de Cita</button>
                <p>Nos pondremos en contacto con usted para confirmar su cita.</p>
            </div>
        </form>
    </div>

{% endblock %}


{# Este bloque añade los scripts JS específicos para esta página al final del <body> #}
{% block scripts %}
    <script>
        const userData = {{ user_data_json | tojson }};
        const todosLosEspecialistas = {{ especialistas_list_json | tojson }};
    </script>
    
    <script src="{{ url_for('static', filename='js/agendar_cita.js') }}"></script>
    <script src="{{ url_for('static', filename='js/validacion.js') }}"></script>
    <script src="{{ url_for('static', filename='js/agendar_cita.js') }}"></script>
{% endblock %}